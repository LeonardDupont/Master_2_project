%% Extracting shape criterion
M = cn2.n_cells;
N = cn.n_cells;

criteria1 = extract_mask_criteria(cn);
criteria2 = extract_mask_criteria(cn2);

deviations = cat(1,criteria1(:,1),criteria2(:,1)); 
spreads = cat(1,criteria1(:,2),criteria2(:,2));
elongations = cat(1,criteria1(:,3),criteria2(:,3));
smoothness = cat(1,criteria1(:,4),criteria2(:,4)); 


bigcn.n_cells = M+N;
for roi = 1:N
    bigcn.mask{1,roi} = cn.mask{1,roi};
end
for roi = 1:M
    bigcn.mask{1,N+roi} = cn2.mask{1,roi};
end

%% Building supervised-learning dataset
N = bigcn.n_cells;
users = {'Leo','Hugo','Jorge','Stringent'};
nuser = length(users); 
good_purkinje_all = zeros(nuser,N);
user = 1; 

clear good_purkinje
% 1 - manual sorting
manual_roi_sorting(bigcn);

% 2 - get the sorting vector
good_purkinje = getglobal_purkinje;
good_purkinje_all(user,:) = good_purkinje;
user = user + 1;


good_pkj_stat = mean(good_purkinje_all,1); 
good_pkj_stat(good_pkj_stat < 0.6) = 0;
good_pkj_stat(good_pkj_stat >= 0.6) = 1;



 
%%

response = good_pkj_stat;
T = ...
  table(deviations,spreads,elongations,smoothness,response.', ...
  'VariableNames',{'deviations','spreads','elongations','smoothness',...
  'response'}); 
clear good_pkj_stat
clear good_purkinje_all
clear good_purkinje

classificationLearner

%%
good_deviations = deviations(good_pkj_stat==1);




figure, hold on
scatter3(





